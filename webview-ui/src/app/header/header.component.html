<div class="header-container">
	<vscode-button
		appearance="icon"
		[aria-label]="allCollapsed ? 'Expand all' : 'Collapse all'"
		[title]="allCollapsed ? 'Expand all' : 'Collapse all'"
		(click)="toggleAllCollapsed()"
		[disabled]="isListEmpty"
	>
		<span>
			<app-icon [name]="allCollapsed ? 'chevron-right' : 'chevron-down'"></app-icon>
		</span>
	</vscode-button>

	@if (syncModeInfo | async; as syncInfo) {
		<vscode-button
			class="sync-pill"
			appearance="icon"
			[matMenuTriggerFor]="syncMenu"
			[aria-label]="syncInfo.pillAriaLabel"
			[title]="syncInfo.pillTooltip"
			(menuOpened)="onSyncMenuOpened()"
			(menuClosed)="onSyncMenuClosed()"
			[ngClass]="{ 'menu-open': isSyncMenuOpen }"
		>
			<span class="sync-pill-content">
				<app-icon [name]="syncInfo.modeIcon"></app-icon>
			</span>
		</vscode-button>
	}

	<vscode-button
		appearance="icon"
		[matMenuTriggerFor]="settingsMenu"
		[aria-label]="'Settings'"
		[title]="'Settings'"
		(menuOpened)="onSettingsMenuOpened()"
		(menuClosed)="onSettingsMenuClosed()"
		[ngClass]="{ 'menu-open': isSettingsMenuOpen }"
	>
		<span>
			<app-icon name="settings"></app-icon>
		</span>
	</vscode-button>
	<!-- Settings menu -->
	<mat-menu #settingsMenu="matMenu" yPosition="below" xPosition="before" panelClass="header-menu">
		<!-- Export submenu -->
		<button mat-menu-item [matMenuTriggerFor]="exportMenu" aria-label="Export" class="submenu-item">
			<span class="submenu-content">
				<app-icon name="export"></app-icon>
				<span style="margin-left: 8px;">Export</span>
			</span>
			<app-icon name="chevron-right" class="submenu-arrow"></app-icon>
		</button>

		<!-- Import submenu -->
		<button mat-menu-item [matMenuTriggerFor]="importMenu" aria-label="Import" class="submenu-item">
			<span class="submenu-content">
				<app-icon name="import"></app-icon>
				<span style="margin-left: 8px;">Import</span>
			</span>
			<app-icon name="chevron-right" class="submenu-arrow"></app-icon>
		</button>

		@if (!(enableWideView | async)) {
			<button mat-menu-item (click)="setWideViewEnabled(true)" aria-label="Wide View">
				<span class="submenu-content">
					<app-icon name="wide-view"></app-icon>
					<span style="margin-left: 8px;">Wide View</span>
				</span>
			</button>
		}
		@if (enableWideView | async) {
			<button mat-menu-item (click)="setWideViewEnabled(false)" aria-label="Normal View">
				<span class="submenu-content">
					<app-icon name="normal-view"></app-icon>
					<span style="margin-left: 8px;">Normal View</span>
				</span>
			</button>
		}

	</mat-menu>

	<!-- Sync menu -->
	<mat-menu #syncMenu="matMenu" panelClass="header-menu">
		@if (syncModeInfo | async; as syncInfo) {
			<button mat-menu-item disabled class="menu-section-label" aria-label="Sync scope">
				<span class="menu-label">Sync - {{ syncInfo.scopeLabel }}</span>
			</button>

			@if (syncInfo.isUserScope) {
				<button
					mat-menu-item
					(click)="setUserSyncMode('profile-local')"
					[title]="'This device only'"
					aria-label="Sync mode: Local"
				>
					<div class="menu-row">
						<span class="menu-left"><app-icon name="local"></app-icon></span>
						<span class="menu-label">Local</span>
						<span class="menu-right">
							@if (syncInfo.mode === "profile-local") {
								<app-icon name="check"></app-icon>
							}
						</span>
					</div>
				</button>
				<button
					mat-menu-item
					(click)="setUserSyncMode('profile-sync')"
					[title]="'Syncs via VS Code Settings Sync'"
					aria-label="Sync mode: Profile Sync"
				>
					<div class="menu-row">
						<span class="menu-left"><app-icon name="profile"></app-icon></span>
						<span class="menu-label">Profile Sync</span>
						<span class="menu-right">
							@if (syncInfo.mode === "profile-sync") {
								<app-icon name="check"></app-icon>
							}
						</span>
					</div>
				</button>
				<button
					mat-menu-item
					(click)="setUserSyncMode('github')"
					[title]="'Syncs via GitHub Gist'"
					aria-label="Sync mode: GitHub Gist"
				>
					<div class="menu-row">
						<span class="menu-left"><app-icon name="github"></app-icon></span>
						<span class="menu-label">GitHub Gist</span>
						<span class="menu-right">
							@if (syncInfo.mode === "github") {
								<app-icon name="check"></app-icon>
							}
						</span>
					</div>
				</button>
			}

			@if (!syncInfo.isUserScope) {
				<button
					mat-menu-item
					(click)="setWorkspaceSyncMode('local')"
					[title]="'This workspace only'"
					aria-label="Sync mode: Local"
				>
					<div class="menu-row">
						<span class="menu-left"><app-icon name="local"></app-icon></span>
						<span class="menu-label">Local</span>
						<span class="menu-right">
							@if (syncInfo.mode === "local") {
								<app-icon name="check"></app-icon>
							}
						</span>
					</div>
				</button>
				<button
					mat-menu-item
					(click)="setWorkspaceSyncMode('github')"
					[title]="'Syncs via GitHub Gist'"
					aria-label="Sync mode: GitHub Gist"
				>
					<div class="menu-row">
						<span class="menu-left"><app-icon name="github"></app-icon></span>
						<span class="menu-label">GitHub Gist</span>
						<span class="menu-right">
							@if (syncInfo.mode === "github") {
								<app-icon name="check"></app-icon>
							}
						</span>
					</div>
				</button>
			}

			<mat-divider></mat-divider>

			<button mat-menu-item disabled class="menu-section-label" aria-label="GitHub status">
				<span class="menu-label">
					GitHub - {{ (isGitHubConnected | async) ? "Connected" : "Not connected" }}
				</span>
			</button>

			@if (!(isGitHubConnected | async)) {
				<button mat-menu-item (click)="connectGitHub()" aria-label="Connect to GitHub">
					<div class="menu-row">
						<span class="menu-left"><app-icon name="github"></app-icon></span>
						<span class="menu-label">Connect to GitHub</span>
						<span class="menu-right"></span>
					</div>
				</button>
			}
			@if (isGitHubConnected | async) {
				<button mat-menu-item (click)="disconnectGitHub()" aria-label="Disconnect from GitHub">
					<div class="menu-row">
						<span class="menu-left"><app-icon name="github"></app-icon></span>
						<span class="menu-label">Disconnect GitHub</span>
						<span class="menu-right"></span>
					</div>
				</button>
			}

			<button mat-menu-item (click)="openGistIdSettings()" aria-label="Gist: Set ID">
				<div class="menu-row">
					<span class="menu-left"><app-icon name="settings"></app-icon></span>
					<span class="menu-label">Gist: Set ID...</span>
					<span class="menu-right"></span>
				</div>
			</button>

			<button
				mat-menu-item
				disabled
				class="menu-info"
				aria-label="Gist file"
				[title]="'Gist file: ' + (syncInfo.gistFile || 'Not set')"
			>
				<span class="menu-label menu-info-text">
					Gist file: {{ syncInfo.gistFile || "Not set" }}
				</span>
			</button>

			<button
				mat-menu-item
				(click)="setGistFileForCurrentScope()"
				[disabled]="!syncInfo.isGitHubMode || !(isGitHubConnected | async) || !(isGistIdConfigured | async)"
				[title]="!syncInfo.isGitHubMode
					? 'Enable GitHub Gist mode to choose a file.'
					: !(isGitHubConnected | async)
						? 'Connect to GitHub to choose a Gist file.'
						: (isGistIdConfigured | async)
							? 'Choose a Gist file for this scope.'
							: 'Set a Gist ID first.'"
				aria-label="Choose Gist file"
			>
				<div class="menu-row">
					<span class="menu-left"><app-icon name="file"></app-icon></span>
					<span class="menu-label">Change Gist file...</span>
					<span class="menu-right"></span>
				</div>
			</button>

			<button
				mat-menu-item
				(click)="viewGistOnGitHub()"
				[disabled]="!(isGistIdConfigured | async)"
				[title]="(isGistIdConfigured | async)
					? 'Open Gist on GitHub'
					: 'Set a Gist ID first.'"
				aria-label="Open Gist on GitHub"
			>
				<div class="menu-row">
					<span class="menu-left"><app-icon name="github"></app-icon></span>
					<span class="menu-label">Open Gist on GitHub</span>
					<span class="menu-right"></span>
				</div>
			</button>

			<mat-divider></mat-divider>

			<button
				mat-menu-item
				(click)="syncNow()"
				[disabled]="!(isGitHubSyncEnabled | async)"
				[title]="syncTooltip | async"
				aria-label="Sync all now"
			>
				<div class="menu-row">
					<span class="menu-left">
						<app-icon name="sync" [class.spinning]="isSyncing | async"></app-icon>
					</span>
					<span class="menu-label">Sync all now</span>
					<span class="menu-right"></span>
				</div>
			</button>
		}
	</mat-menu>

	<!-- Export submenu -->
	<mat-menu #exportMenu="matMenu">
		<button mat-menu-item (click)="export(ExportFormats.JSON)" aria-label="Export to JSON">
			JSON
		</button>
		<button mat-menu-item (click)="export(ExportFormats.MARKDOWN)" aria-label="Export to Markdown">
			Markdown
		</button>
	</mat-menu>

	<!-- Import submenu -->
	<mat-menu #importMenu="matMenu">
		<button mat-menu-item (click)="import(ImportFormats.JSON)" aria-label="Import from JSON">
			JSON
		</button>
		<button mat-menu-item (click)="import(ImportFormats.MARKDOWN)" aria-label="Import from Markdown">
			Markdown
		</button>
	</mat-menu>


	<vscode-button
		appearance="icon"
		[aria-label]="'Delete all items in this tab'"
		[title]="'Delete all items in this tab'"
		(click)="deleteAll()"
		[disabled]="isListEmpty"
	>
		<app-icon name="trash"></app-icon>
	</vscode-button>

	<vscode-button
		appearance="icon"
		[aria-label]="'Clear completed todos in this tab'"
		[title]="'Clear completed todos in this tab'"
		(click)="deleteCompleted()"
		[disabled]="!hasCompletedTodos"
	>
		<app-icon name="clear"></app-icon>
	</vscode-button>
</div>
